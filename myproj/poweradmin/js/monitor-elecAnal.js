$(function(){var E=0,V=0,_=0,P="",B="";layui.use(["table","layer","laydate"],function(){var i=layui.table,n=layui.laydate,f=layui.layer;function o(e){n.render({elem:e,type:"time",format:"HH:mm:ss",value:new Date,isInitValue:!0,done:function(e){}})}function a(e){f.msg(e)}function e(e,a){$(e).change(function(){_=$(this).val(),(_=parseInt(_))&&NaN!==_&&a&&a(_)})}lay(".time-range").each(function(){n.render({elem:this,type:"datetime",format:"yyyy-MM-dd HH:mm:ss",isInitValue:!0,range:!0,done:function(e){var a=e.split(" - ");P=a[0],B=a[1]}})}),$(".select-time").each(function(){var e=$(this).parent().next(".select-date"),a=(e.children(".time-range"),$(this).data("timeselect"));$(this).on("change",function(){$(this).is(":checked")?e.removeClass("tchide"):e.addClass("tchide"),"query1"==a&&$("[data-datetype]").removeClass("on")})}),$("body").on("click",".time-cell",function(){var a=$(this),t=$(this).parents("td"),e=a.text(),i=$(this).parent(".layui-table-cell").outerWidth(),l=$('<input type="text" class="cell-edit cell-time">').width(i).attr("value",e);$(this).parents("td").append(l),n.render({elem:l[0],type:"time",format:"HH:mm:ss",value:new Date,isInitValue:!0,done:function(e){if(""==e)return!1;a.text(e),t.data("content",e),l.hide()}})});var t={chartBg:"transparent",axisLineC:"#ebeef0",xAxisLabelC:"#99a8bf",yAxisLabelC:"#4a4b56",legendC:"#333",legendC2:"#646487"},v=echarts.init(document.getElementById("chart_lg"));data=[["00:00",116],["00:30",129],["01:00",135],["01:30",86],["02:00",73],["02:30",85],["03:00",73],["02:30",68],["03:00",92],["03:30",130],["04:00",245],["04:30",139],["05:00",115],["05:30",111],["06:00",309],["06:30",206],["07:00",137],["07:30",128],["08:00",85],["08:30",94],["09:00",71],["09:30",106],["10:00",84],["10:30",93],["11:00",85],["11:30",73],["12:00",83],["12:30",125],["13:00",107],["13:30",82],["14:00",44],["14:30",72],["15:00",106],["15:30",107],["16:00",66],["16:30",91],["17:00",92],["17:30",113],["18:00",107],["18:30",131],["19:00",111],["19:30",64],["20:00",69],["20:30",88],["21:00",77],["21:30",83],["22:00",111],["22:30",57],["23:00",55],["23:30",60]],data2=[["00:00",106],["00:30",120],["01:00",125],["01:30",116],["02:00",173],["02:30",95],["03:00",83],["02:30",78],["03:00",82],["03:30",120],["04:00",225],["04:30",131],["05:00",125],["05:30",101],["06:00",209],["06:30",106],["07:00",157],["07:30",168],["08:00",185],["08:30",194],["09:00",171],["09:30",106],["10:00",94],["10:30",93],["11:00",75],["11:30",83],["12:00",93],["12:30",105],["13:00",117],["13:30",112],["14:00",144],["14:30",172],["15:00",156],["15:30",137],["16:00",96],["16:30",81],["17:00",82],["17:30",103],["18:00",117],["18:30",121],["19:00",91],["19:30",84],["20:00",89],["20:30",98],["21:00",107],["21:30",121],["22:00",141],["22:30",157],["23:00",75],["23:30",80]];var l=data.map(function(e){return e[0]}),r=data.map(function(e){return e[1]}),s=data2.map(function(e){return e[1]}),d=data2.map(function(e){return e[1]*Math.ceil(2*Math.random())}),h={backgroundColor:t.chartBg,color:["#8757f8","#0782d9","#ffb300","#f87761","#0099FF"],toolbox:{feature:{saveAsImage:{}}},legend:{align:"right",right:40,itemWidth:10,itemHeight:10,textStyle:{color:t.legendC},data:["尖","峰","平","谷"]},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],start:1,end:50},{type:"inside",xAxisIndex:[0],start:1,end:50}],title:[{left:"right"}],tooltip:{trigger:"axis",padding:0,formatter:function(e){for(var a='<div class="chartTooltip bg-global"><div class="trang"></div>',t=0;t<e.length;t++)a+="<p>"+e[t].seriesName+"<br>"+e[t].axisValue+" "+e[t].value+"%</p>";return a+="</div>"}},xAxis:{axisLabel:{color:t.xAxisLabelC},axisLine:{lineStyle:{color:t.axisLineC}},data:l},yAxis:{name:"百分比%",nameTextStyle:{color:t.legendC},axisLine:{show:!1,lineStyle:{color:t.axisLineC}},axisLabel:{color:t.yAxisLabelC},splitLine:{show:!0,lineStyle:{color:t.axisLineC}}},series:[{name:"尖",type:"line",color:["#8757f8"],data:r},{name:"峰",type:"line",color:["#0782d9"],data:s},{name:"平",type:"line",color:["#ffb300"],data:r},{name:"谷",type:"line",color:["#f87761"],data:d}]};v.setOption(h);var c={backgroundColor:t.chartBg,color:["#0099ff","#62cea0"],legend:{align:"right",right:40,itemWidth:10,itemHeight:10,textStyle:{color:t.legendC},data:["2018","2017"]},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],start:1,end:40},{type:"inside",xAxisIndex:[0],start:1,end:40}],title:[{left:"right"}],tooltip:{trigger:"axis",padding:0,formatter:function(e){for(var a='<div class="chartTooltip bg-global"><div class="trang"></div>',t=0;t<e.length;t++)a+="<p>"+e[t].seriesName+"<br>"+e[t].axisValue+"："+e[t].value+"</p>";return a+="</div>"}},xAxis:{axisLabel:{color:t.xAxisLabelC},axisLine:{lineStyle:{color:t.axisLineC}},data:l},yAxis:{name:"kWh 同比分析",nameTextStyle:{color:t.legendC},axisLine:{show:!1,lineStyle:{color:t.axisLineC}},axisLabel:{color:t.yAxisLabelC},splitLine:{show:!0,lineStyle:{color:t.axisLineC}}},series:[{name:"2018",type:"bar",color:["#0099ff"],data:r},{name:"2017",type:"bar",color:["#62cea0"],data:s}]},u=echarts.init(document.getElementById("chart_same"));u.setOption(c);var p=echarts.init(document.getElementById("chart_compare")),m=JSON.parse(JSON.stringify(c));m.legend.data=["2018","2017"],m.color=["#ff763c","#fdc449"],m.xAxis.data=l,m.yAxis.name="kWh 环比分析",m.tooltip={trigger:"axis",padding:0,formatter:function(e){for(var a='<div class="chartTooltip bg-global"><div class="trang"></div>',t=0;t<e.length;t++)a+="<p>"+e[t].seriesName+"<br>"+e[t].axisValue+"："+e[t].value+"</p>";return a+="</div>"}},m.series=[{name:"2018",type:"bar",color:["#ff763c"],data:r},{name:"2017",type:"bar",color:["#fdc449"],data:d}],p.setOption(m);var y=echarts.init(document.getElementById("chart_combine")),b={backgroundColor:t.chartBg,color:["#4dd8ab","#a467f3","#f8e24e"],title:[{show:!1},{text:"占比分析",left:"70%",textStyle:{fontWeight:"normal",color:t.legendC}}],toolbox:{feature:{saveAsImage:{}}},dataZoom:[{type:"slider",start:0,end:40},{type:"inside",start:0,end:40}],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"1%",right:"35%",top:"16%",bottom:40,containLabel:!0},legend:[{left:"20%",textStyle:{color:t.legendC},data:["班次1","班次2","班次3"]},{right:"10%",textStyle:{color:t.legendC,fontSize:14},bottom:10,itemWidth:10,itemHeight:10,borderRadius:5,data:[{name:"班次1",icon:"circle"},{name:"班次2",icon:"circle"},{name:"班次3",icon:"circle"}]}],xAxis:{data:l,boundaryGap:!1,axisLine:{show:!1,lineStyle:{color:t.axisLineC}},axisLabel:{textStyle:{color:t.xAxisLabelC,fontSize:10}},axisTick:{show:!1},splitLine:{show:!0,lineStyle:{color:t.axisLineC}}},yAxis:[{name:"用电量kWh",type:"value",nameTextStyle:{color:t.legendC},splitLine:{show:!1},axisLine:{lineStyle:{color:t.axisLineC}},axisLabel:{color:t.yAxisLabelC}}],series:[{name:"班次1",type:"line",showSymbol:!1,lineStyle:{color:"#4dd8ab",width:3},areaStyle:{normal:{type:"default",color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#4dd8ab"},{offset:1,color:"rgba(0,0,0,0)"}],!1)}},data:r},{name:"班次2",type:"line",showSymbol:!1,lineStyle:{color:"#a467f3",width:3},data:s},{name:"班次3",type:"line",showSymbol:!1,lineStyle:{color:"#f8e24b",width:3},data:d},{type:"pie",selectedMode:"single",tooltip:{show:!1,trigger:"item",formatter:"{b}: {c} ({d}%)"},center:["83%","50%"],radius:["40%","60%"],label:{normal:{position:"inner",formatter:"{d}%",textStyle:{color:"#fff",fontWeight:"bold",fontSize:12}}},labelLine:{normal:{show:!1}},data:[{value:180,name:"班次1"},{value:280,name:"班次2"},{value:335,name:"班次3"}]}]};y.setOption(b);var g=[{usage:"尖累计用电：0.00kWh",prec:"尖占比：0.00%",total:"尖总电价：0"},{usage:"峰累计用电：0.00kWh",prec:"峰占比：0.00%",total:"峰总电价：0"}],x=i.render({elem:"#tableRate",unresize:!0,cols:[[{field:"usage",title:"累计用电"},{field:"prec",title:"占比"},{field:"total",title:"总电价"}]],data:g,done:function(){}});function A(){$("#chart_lg").append('<div class="chart-nodata bg-transparent"><div class="table-box"><div class="table-cell"><p class="chart-tip">暂无数据</p></div></div></div>'),h.xAxis.data=[],h.series.data=[],h.legend.data=[],v.setOption(h,!0),v.hideLoading()}function T(i,e,a,t,l,n){1==i?($("#chart_same").find(".chart-nodata").remove(),u.showLoading()):2==i&&($("#chart_compare").find(".chart-nodata").remove(),p.showLoading());var r="";1==i?r="/api/web/coulometry/queryYoY":2==i&&(r="/api/web/coulometry/querylinkRelative"),null==l&&(l=""),null==n&&(n=""),getData({request:"POST",url:apiRoot+r,token:TOKEN,data:{pricePlanId:e,nodeId:a,dateModel:t,startTime:l,endTime:n}},function(e){if(e&&200===e.code&&e.data)if(0===e.data.length){var a='<div class="chart-nodata bg-transparent"><div class="table-box"><div class="table-cell"><p class="chart-tip">暂无数据</p></div></div></div>';1==i?($("#chart_same").append(a),c.legend.data=[],c.xAxis.data=[],c.series.data=[],u.setOption(c,!0),u.hideLoading()):2==i&&($("#chart_compare").append(a),m.legend.data=[],m.xAxis.data=[],m.series.data=[],p.setOption(m,!0),p.hideLoading())}else{var t=function(e){var a={legendArr:[],timeArr:[],valArr:[],serisArr:[]},t=e;for(var i in t){a.legendArr.push(t[i].data.toString());var l=t[i].dataList;for(var n in a.timeArr[i]=[],a.valArr[i]=[],l)a.timeArr[i].push(null==l[n]?0:l[n].START_DATE_TIME),a.valArr[i].push(null==l[n]?0:l[n].D_VALUE);a.serisArr.push({name:a.legendArr[i],type:"bar",data:a.valArr[i]})}return a}(e.data);1==i?(c.legend.data=t.legendArr,c.xAxis.data=t.timeArr[0],c.series=t.serisArr,u.setOption(c,!0),u.hideLoading()):2==i&&(m.legend.data=t.legendArr,m.xAxis.data=t.timeArr[0],m.series=t.serisArr,p.setOption(m,!0),p.hideLoading())}})}function L(e,a,t,i,l){$("#chart_combine").find(".chart-nodata").remove(),y.showLoading(),null==i&&(i=""),null==l&&(l=""),getData({request:"POST",url:apiRoot+"/api/web/coulometry/flight",token:TOKEN,data:{flightPlanId:e,nodeId:a,dateModel:t,startTime:i,endTime:l}},function(e){if(e&&200===e.code){var a=e.data;if(null!=a&&0!==a.length&&a[0]&&a[0].dataList&&0!==a[0].dataList.length){var t=[],i={timeArr:[],valArr:[]},l={legendArr:[],TimeArr:[],ValArr:[],percArr:[],serisArr:[],circleVal:[],circleLegen:[]},n=0;for(var r in a){var s=[];if("总"==a[r].rateName)for(var o in s=a[r].dataList)i.timeArr.push(s[o].START_DATE_TIME),i.valArr.push(s[o].VALUE);else{for(var d in t=a[r].dataList,l.legendArr.push(a[r].rateName),l.circleLegen.push({name:a[r].rateName,icon:"circle"}),l.circleVal.push({name:a[r].rateName,value:a[r].TOTAL}),l.TimeArr[n]=[],l.ValArr[n]=[],l.percArr[n]=[],t)l.percArr[n].push((100*t[d].proportion).toFixed(2)),l.TimeArr[n].push(t[d].START_DATE_TIME),l.ValArr[n].push(t[d].VALUE);l.serisArr.push({name:l.legendArr[n],type:"line",lineStyle:{width:3},data:l.ValArr[n]}),n+=1}}b.legend[0].data=l.legendArr,b.legend[1].data=l.circleLegen,b.xAxis.data=l.TimeArr[0],b.series=l.serisArr,b.series.push({type:"pie",selectedMode:"single",tooltip:{show:!1,trigger:"item",formatter:"{b}: {c} ({d}%)"},center:["83%","50%"],radius:["40%","60%"],label:{normal:{position:"inner",formatter:"{d}%",textStyle:{color:"#fff",fontWeight:"bold",fontSize:12}}},labelLine:{normal:{show:!1}},data:l.circleVal}),y.setOption(b,!0),y.hideLoading()}else $("#chart_combine").append('<div class="chart-nodata bg-transparent"><div class="table-box"><div class="table-cell"><p class="chart-tip">暂无数据</p></div></div></div>'),y.setOption({legend:{data:[]},xAxis:{data:[]},series:[]}),y.hideLoading()}})}var S,w=[],k=[];function C(e){getData({request:"POST",url:apiRoot+"/api/web/electroparam/rate",data:"&id="+e,token:TOKEN},function(e){var a=e.data;0===a.length&&(A(),f.msg("没有费率列表数据"));for(var t=[],i=0,l=a.length;i<l;i++){var n=a[i];V=a[0].pricePlanId,t.push({pricePlanId:n.pricePlanId,id:n.id,startTime:n.startTime,endTime:n.endTime,rateName:n.rateName,price:n.price})}w=t,k=JSON.parse(JSON.stringify(t)),function(e,a,f,t,i){if($("#chart_lg").find(".chart-nodata").remove(),v.showLoading(),null==t&&(t=""),null==i&&(i=""),0==e)return A();getData({request:"POST",url:apiRoot+"/api/web/coulometry/queryline",token:TOKEN,data:{pricePlanId:e,nodeId:a,dateModel:f,startTime:t,endTime:i}},function(e){if(console.log(e),e&&200===e.code&&e.data){var a=e.data,t=[];if(0<a.length&&1==f){for(var i in a){var l,n;l=null==a[i].proportion?0:(100*a[i].proportion).toFixed(2),n=null==a[i].price?0:a[i].price,t.push({usage:a[i].rateName+"累计用电："+a[i].TOTAL+"kWh",prec:a[i].rateName+"占比："+l+"%",total:a[i].rateName+"总电价："+n})}g=t,x.reload({data:g})}if(0===a.length)A(),x.reload({data:[]});else if(4==f&&!a[0]||5==f&&!a[0]||6==f&&!a[0])A();else if(1==f&&0===a[0].dataList.length||2==f&&0===a[0].dataList.length||3==f&&0===a[0].dataList.length)A();else{var r=[],s={timeArr:[],valArr:[]},o={legendArr:[],TimeArr:[],ValArr:[],yAxisArr:[],serisArr:[]},d=0;if(1==f||2==f||3==f)for(var c in a){var u=[];if("总"==a[c].rateName)for(var p in u=a[c].dataList)s.timeArr.push(u[p].START_DATE_TIME),s.valArr.push(u[p].VALUE);else{for(var m in r=a[c].dataList,o.legendArr.push(a[c].rateName),o.TimeArr[d]=[],o.ValArr[d]=[],o.yAxisArr[d]=[],r)1==f?o.yAxisArr[d].push((100*r[m].proportion).toFixed(2)):(o.TimeArr[d].push(r[m].START_DATE_TIME),o.ValArr[d].push(r[m].VALUE));1==f?o.serisArr.push({name:o.legendArr[d],type:"line",lineStyle:{width:3},data:o.yAxisArr[d]}):o.serisArr.push({name:o.legendArr[d],type:"bar",stack:"总量",data:o.ValArr[d]}),d+=1}}if(4==f||5==f||6==f||7==f){for(var c in o.legendArr=["总用电量"],a)o.TimeArr.push(null==a[c]?0:a[c].START_DATE_TIME),o.ValArr.push(null==a[c]?0:a[c].D_VALUE);o.serisArr=[{name:"总用电量",type:"line",lineStyle:{width:3},data:o.ValArr}]}1==f?(h.yAxis.name="百分比%",h.xAxis.data=s.timeArr):(h.yAxis.name="用电量kWh",h.xAxis.data=o.TimeArr,h.tooltip.formatter=function(e){for(var a='<div class="chartTooltip bg-global"><div class="trang"></div>',t=0;t<e.length;t++)a+="<p>"+e[t].seriesName+"<br>"+e[t].axisValue+"："+e[t].value+"</p>";return a+="</div>"}),h.legend.data=o.legendArr,h.series=o.serisArr,v.setOption(h,!0),v.hideLoading()}}})}(V,E,1),T(1,V,E,1),T(2,V,E,1)})}i.on("tool(table1)",function(t){var e=t.data,a=t.event,i=t.tr,l=$(i).data("index"),n=$(i).find(".btn-contain"),r=$(i).find(".cell-edit");function s(){n.children(".ed-de").removeClass("tchide"),n.children(".ens-can").addClass("tchide"),r.remove()}if("cellClick"===a){n.children(".ed-de").addClass("tchide"),n.children(".ens-can").removeClass("tchide");var o=k[l];for(var d in o){(p=$(i).find("td[data-field="+d+"]")).data("oldval",o[d])}}else if("del"===a)f.confirm("真的删除行么",{skin:"layer-dialog"},function(e){f.close(e)});else if("ensure"===a){s(),$(i).find("td[data-content]").each(function(){var e=$(this).data("field"),a=$(this).data("content");"rateName"==e&&(a=$(this).find("input.layui-unselect").val()),t.data[e]=a}),t.update(),console.log(e,E);var c=f.load();getData({request:"POST",url:apiRoot+"/api/web/electroparam/updaterate",contentType:"application/json;charset=UTF-8",data:JSON.stringify(e),token:TOKEN},function(e){var r;console.log(e),201===e.code?(f.close(c),f.msg("修改成功",{icon:1}),r=parseInt(E),getData({request:"POST",url:apiRoot+"/api/web/electroparam/priceplan",data:"&nodeId="+r,token:TOKEN},function(e){var a=e.data;if(a){$("#pricePlanSel").data("nodeid",r);for(var t=a[0].id,i="",l=0,n=a.length;l<n;l++)i+='<option value="'+a[l].id+'">'+a[l].name+"</option>";$("#pricePlanSel").html(i),C(t)}else f.msg("没有电价方案数据"),A(),$("#pricePlanSel").html("<option>没有数据</option>")})):(f.msg("修改失败",{icon:5}),f.close(c))})}else if("cancel"===a){s();var u=k[l];for(var d in u){var p,m=(p=$(i).find("td[data-field="+d+"]")).find(".txel");p.data("content",u[d]),"rateName"==d?(p.find(".layui-unselect").val(u[d]),p.find(".layui-anim-upbit").children("dd[lay-value="+u[d]+"]").addClass("layui-this").siblings().removeClass("layui-this")):m.text(u[d])}}}),e("#pricePlanSel",function(e){C(e)}),$(".add-table").click(function(){f.open({type:1,title:"新增方案",area:"1150px",closeBtn:0,skin:"layer-dialog",content:'<div class="dialog-form-wrap"><form method="post" class="layui-form add-plan"><div class="layui-form-item"><label class="layui-form-label">方案名称</label><div class="layui-input-block"><input type="text" name="title" required  lay-verify="required" placeholder="请输入方案名称" autocomplete="off" class="layui-input tit planName"></div></div><div class="input-group"><div class="inputs-im"><div class="layui-inline"><label class="layui-form-label">开始时间</label><div class="layui-input-inline"><input type="text" name="startTime" autocomplete="off" class="layui-input add-time"></div></div><div class="layui-inline"><label class="layui-form-label">结束时间</label><div class="layui-input-inline"><input type="text" name="endTime" autocomplete="off" class="layui-input add-time"></div></div><div class="layui-inline"><label class="layui-form-label">费率</label><div class="layui-input-inline"><select name="rateName" class="tc-select" lay-ignore><option value="尖">尖</option><option value="峰">峰</option><option value="平">平</option><option value="谷">谷</option></select></div></div><div class="layui-inline"><label class="layui-form-label">费率价格</label><div class="layui-input-inline"><input type="text" name="price" autocomplete="off" class="layui-input" placeholder="请输入数字，保留2位小数"></div></div><div class="layui-inline"><span class="btn-ipt-add btn-priceipt-add"><i class="iconfont icon-add"></i></span><span class="btn-ipt-cut tchide"><i class="iconfont icon-cut"></i></span></div></div></div></form><div class="layui-form-item btn-cont"><div class="layui-input-block"><button class="layui-btn layui-btn-radius subBtn" lay-submit lay-filter="formDemo">确认</button><button class="layui-btn layui-btn-radius cancelBtn">取消</button></div></div></div>',success:function(e,l){var a=e.find(".subBtn"),t=e.find(".cancelBtn"),n=e.find("form"),i=e.find(".add-time"),r=e.find(".planName"),s=e.find('input[name="price"]');i.each(function(){o(this)}),t.click(function(){f.close(l)}),a.click(function(){var e=n.serializeArray();if(""==$.trim(r.val()))return f.msg("方案名称不能为空",{icon:5}),!1;if(!/^[0-9](\.\d{1,4})?$/.test(s.val()))return f.msg("费率价格格式不正确",{icon:5}),!1;var a=e.slice(1);[].push(e.slice(0,1));var t=formatData(a,4);console.log(t);var i={pricePlan:{nodeId:$("#pricePlanSel").data("nodeid"),name:r.val()},rateList:t};getData({request:"POST",url:apiRoot+"/api/web/electroparam/addpriceplanandrate",token:TOKEN,data:"json="+JSON.stringify(i)},function(e){console.log(e),200===e.code?(f.msg("添加成功",{icon:1}),w=w.concat(t),S.reload({data:w}),f.close(l)):f.msg("添加失败，请重试",{icon:5})})})}})}),$(".edit-price").click(function(){$("#pricePlanSel").html(),f.open({type:1,title:"修改方案",area:"1060px",closeBtn:0,skin:"layer-dialog",content:'<div class="dialog-form-wrap"><div class="tc-table-wrap tc-nor-table-warp table-separate"><table id="table1" class="tc-nor-table" lay-filter="table1"></table></div><div class="layui-form-item btn-cont"><div class="layui-input-block"><button class="layui-btn layui-btn-radius subBtn">确认</button><button class="layui-btn layui-btn-radius cancelBtn">取消</button></div></div></div>',success:function(e,a){var t=e.find(".subBtn");e.find(".cancelBtn").click(function(){f.close(a)}),S=i.render({elem:"#table1",unresize:!0,cols:[[{field:"pricePlanId",title:"方案id"},{field:"id",title:"ID",width:"10%"},{field:"startTime",width:"15%",title:"开始时间",event:"cellClick",templet:'<div><span class="txel time-cell">{{d.startTime}}</span></div>'},{field:"endTime",width:"15%",title:"结束时间",event:"cellClick",templet:'<div><span class="txel time-cell">{{d.endTime}}</span></div>'},{field:"rateName",width:"15%",event:"cellClick",title:"费率",templet:"#selectTpl"},{field:"price",width:"15%",event:"cellClick",edit:"text",title:"费率价格",templet:'<div><span class="txel">{{d.price}}</span></div>'},{field:"operate",width:"15%",title:"操作",toolbar:"#toolbar"}]],data:w,done:function(){$("[data-field='pricePlanId']").css("display","none"),$("[data-field='id']").css("display","none"),$("#table1").next().find('[data-field="startTime"]').css("border-left-width","1px")}}),t.on("click",function(){f.close(a)})}})}),$(".del-price").click(function(){var n,e;n="/api/web/electroparam/delpriceplan",e=$("#pricePlanSel").html(),f.open({type:1,title:"删除方案",closeBtn:0,skin:"layer-dialog",content:'<div class="dialog-form-wrap"><form class="layui-form add-plan"><div class="layui-form-item"><label class="layui-form-label">方案名称</label><div class="layui-input-block"><select name="planId" class="tc-select" lay-ignore>'+e+'</select></div></div></form><div class="layui-form-item btn-cont"><div class="layui-input-block"><button class="layui-btn layui-btn-radius subBtn">确认</button><button class="layui-btn layui-btn-radius cancelBtn">取消</button></div></div></div>',success:function(e,a){var t=e.find(".subBtn"),i=e.find(".cancelBtn"),l=(e.find("form"),e.find('[name="planId"]'));i.click(function(){f.close(a)}),t.click(function(){getData({request:"POST",url:apiRoot+n,token:TOKEN,data:"id="+l.val()},function(e){console.log(e),200===e.code?f.msg("删除成功",{icon:1}):f.msg("删除失败，请重试",{icon:5}),f.close(a)})})}})});var N,I;function O(){v.resize(),u.resize(),p.resize(),y.resize()}N=".btn-priceipt-add",I='<div class="layui-inline"><label class="layui-form-label">开始时间</label><div class="layui-input-inline"><input type="text" name="starTime" autocomplete="off" class="layui-input add-time"></div></div><div class="layui-inline"><label class="layui-form-label">结束时间</label><div class="layui-input-inline"><input type="text" name="endTime" autocomplete="off" class="layui-input add-time"></div></div><div class="layui-inline"><label class="layui-form-label">费率</label><div class="layui-input-inline"><select name="rateName" class="tc-select" lay-ignore><option value="尖">尖</option><option value="峰">峰</option><option value="平">平</option><option value="谷">谷</option></select></div></div><div class="layui-inline"><label class="layui-form-label">费率价格</label><div class="layui-input-inline"><input type="text" name="price" autocomplete="off" class="layui-input" placeholder="请输入数字，保留2位小数"></div></div>',$("body").on("click",N,function(){var e='<div class="inputs-im">'+I+'<span class="btn-ipt-cut"><i class="iconfont icon-cut"></i></span></div>';$(this).parents(".input-group").append(e),lay(".add-time").each(function(){o(this)})}),$("body").on("click",".btn-ipt-cut",function(){$(this).parents(".inputs-im").remove()}),$("body").on("click","layui-input.add-time",function(){o(this)}),e("#workShiftSel",function(e){L(e,E,2)}),$("[data-datetype]").on("click",function(){var e=$(this).data("datetype");$(this).data("datemodel");if($(this).hasClass("on"))return!1;switch($(this).addClass("on").siblings().removeClass("on"),e){case"daytime":case"monthtime":case"yeartime":$("#chartTwo").addClass("tchide"),$("#powerTableCon").removeClass("tchide");break;case"day":case"month":case"year":$("#chartTwo").removeClass("tchide"),$("#powerTableCon").addClass("tchide"),u.resize(),p.resize()}}),$("#queryUsage").on("click",function(){""==$(this).prev().val()&&a("请选择日期")}),$('input[name="dateline"]').on("change",function(){$(this).prop("checked",!0),$(this).parent().siblings().children(".tc-radio").prop("checked",!1);var e=$("input[name='dateline']:checked").val(),a=$(this).parent().siblings(".select-date");a.addClass("tchide"),"custom"==e&&a.removeClass("tchide"),_=$("#workShiftSel").val(),_=parseInt(_)}),$("#queryWorkUsage").on("click",function(){var e=$(this).prev();if(_=$("#workShiftSel").val(),_=parseInt(_),""==e.val())return a("请选择日期"),!1;_&&NaN!==_?L(_,E,4,P,B):a("没有班次方案数据")}),$("#menuTree").contextMenu({selector:"a",items:{firstCommand:{name:"选择",icon:"select",className:"contextmenu-select",callback:function(e,a,t){$(".on").removeClass("on"),$(this).addClass("on"),E=$(this).data("menuid")}}}}),window.addEventListener("resize",function(){O()}),$("#listenInput").on("blur change",function(){setTimeout(function(){O()},300)})})});